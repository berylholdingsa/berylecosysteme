# GreenOS Hostile Audit Expected Answers

Version: 2026-02-17
Method: answers grounded in implementation paths

## A. MRV integrity and reproducibility
1. Determinism is enforced by canonical serialization + strict hashing in `src/orchestration/esg/greenos/mrv/canonical.py`.
2. Key-order variance is neutralized via sorted key traversal and `json.dumps(..., sort_keys=True)` in `src/orchestration/esg/greenos/mrv/canonical.py`.
3. Decimal normalization is quantized and string-rendered in `_normalize_decimal` at `src/orchestration/esg/greenos/mrv/canonical.py`.
4. No; payload alteration changes `sha256_hex_strict(payload)` and fails `hash_valid` in `verify_export_payload` (`src/orchestration/esg/greenos/mrv/engine.py`).
5. `verified` requires `hash_valid and signature_valid and asym_signature_valid and methodology_valid` in `src/orchestration/esg/greenos/services/greenos_service.py`.
6. Methodology drift is detected by recomputing methodology hash against registry state in `_verify_export_methodology_binding` (`src/orchestration/esg/greenos/services/greenos_service.py`).
7. Export is blocked when baseline is empty in `_validate_methodology_for_export` (`src/orchestration/esg/greenos/services/greenos_service.py`).
8. Export is blocked when scope countries are not documented by `_country_factors_documented` and validator gate in `src/orchestration/esg/greenos/services/greenos_service.py`.

## B. Double counting and replay resistance
9. Ledger uniqueness is enforced by DB unique constraint `(trip_id, model_version)` in `src/db/models/esg_greenos.py`.
10. Replay collapses to idempotent retrieval in repository/service path (`create_or_get_in_session`) in `src/orchestration/esg/greenos/ledger/repository.py` and `src/orchestration/esg/greenos/services/greenos_service.py`.
11. Same trip across model versions can exist in ledger by design; MRV export dedup keeps one row per `trip_id` in `_deduplicate_trip_records` (`src/orchestration/esg/greenos/mrv/engine.py`).
12. Dedup rule is explicit: `latest_created_at_per_trip_id` in proof payload in `src/orchestration/esg/greenos/mrv/engine.py`.
13. Proof is materialized in export payload (`non_double_counting_proof`) with `proof_hash` in `src/orchestration/esg/greenos/mrv/engine.py`.
14. MRV period uniqueness is a DB constraint `uq_esg_mrv_export_period` in `src/db/models/esg_greenos.py`.
15. API returns 409 with `GREENOS_MRV_EXPORT_EXISTS` in `src/orchestration/esg/greenos/api/router.py`.
16. Semantic duplicate evasion is partially mitigated by dedup key `trip_id`; this is an explicit assumption documented in whitepaper (`src/orchestration/esg/greenos/docs/GREENOS_WHITEPAPER.md`).

## C. Cryptographic non-repudiation
17. HMAC ensures backward/internal continuity while Ed25519 enables public verification; both are implemented in `src/orchestration/esg/greenos/services/signing.py`.
18. External verification uses public key only through `verify_hash_with_public_key` in `src/orchestration/esg/greenos/services/signing.py`.
19. Stable publication points are `/api/v2/esg/public-key` and `/.well-known/greenos-public-key` in `src/orchestration/esg/greenos/api/router.py` and `src/main.py`.
20. Fingerprint is returned as `fingerprint_sha256` from `get_public_key` in `src/orchestration/esg/greenos/services/signing.py`.
21. Invalid base64 signatures fail in `_signature_from_base64` and return verification false in `src/orchestration/esg/greenos/services/signing.py`.
22. Public-key-only verification with wrong key fails by signature mismatch; see helper behavior in `src/orchestration/esg/greenos/services/signing.py`.
23. Rotation keeps historical keyrings via `*_KEYS_JSON` and key version fields, implemented in `src/orchestration/esg/greenos/services/signing.py`.
24. Production fail-closed checks are in `_validate_production_signing_configuration` in `src/orchestration/esg/greenos/services/signing.py`.

## D. Secret governance and operational security
25. Runtime secret providers are implemented in `src/orchestration/esg/greenos/secrets/` and wired in `src/orchestration/esg/greenos/services/signing.py`.
26. Secret values are never logged; logs include metadata only (provider, secret name, error type) in `src/orchestration/esg/greenos/services/signing.py`.
27. Partial/missing Vault/KMS material in production raises startup `RuntimeError` through provider readiness checks in `src/orchestration/esg/greenos/services/signing.py`.
28. Non-sensitive status snapshot is generated by `secret_status_snapshot` in `src/orchestration/esg/greenos/services/signing.py`.
29. Secrets status endpoint requires admin scope via `_require_admin_scope` in `src/orchestration/esg/greenos/api/router.py`.
30. Placeholder/missing/invalid key checks for HMAC and Ed25519 are enforced in `src/orchestration/esg/greenos/services/signing.py`.

## E. Reliability, delivery guarantees, and DLQ
31. Atomicity is achieved by writing ledger and outbox in the same DB transaction in `calculate_realtime_impact` (`src/orchestration/esg/greenos/services/greenos_service.py`).
32. Multi-worker double publish risk is reduced by `SELECT ... FOR UPDATE SKIP LOCKED` for PostgreSQL in `claim_pending` (`src/orchestration/esg/greenos/outbox/repository.py`).
33. Under retry storm, events are retried until threshold then marked FAILED and sent to DLQ in `run_once` (`src/orchestration/esg/greenos/outbox/relay_service.py`).
34. Transition rule is `if row.retry_count + 1 > max_retry_count` then DLQ + `mark_failed` in `src/orchestration/esg/greenos/outbox/relay_service.py`.
35. Metrics are emitted via `greenos_outbox_retry_total` and `greenos_outbox_failed_total` in `src/orchestration/esg/greenos/outbox/relay_service.py` and defined in `src/orchestration/esg/greenos/outbox/metrics.py`.
36. DLQ metric evidence is recorded by `metrics.record_dlq_event(self._dlq_topic)` in `src/orchestration/esg/greenos/outbox/relay_service.py`.

## F. Governance, bias, and institutional defensibility
37. Trust boundary limits are documented in `src/orchestration/esg/greenos/docs/GREENOS_WHITEPAPER.md` (limitations/hypotheses section).
38. Country-factor governance requirement and no-fallback behavior are encoded in realtime validation at `src/orchestration/esg/greenos/realtime/engine.py`.
39. Methodology change control is enforced by version uniqueness and active/deprecated status in `src/orchestration/esg/greenos/mrv/methodology_repository.py` and model constraints in `src/db/models/esg_greenos.py`.
40. Minimum evidence archive package is specified in `src/orchestration/esg/greenos/docs/GREENOS_AUDITOR_GUIDE.md`.

## Adversarial tests implemented
The hostile package is concretized by adversarial tests in:
- `tests/unit/greenos/test_greenos_foundation.py`

Covered cases:
- MRV payload tampered => verify false.
- Methodology hash mismatch => verify false.
- Wrong public key version for external verification => false.
- MRV overlap period => API 409 conflict.
- Replay event storm => no double counting.
- Outbox retry storm => FAILED + DLQ + metrics increments.
